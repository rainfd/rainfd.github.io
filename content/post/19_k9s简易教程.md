---
title: "19_k9s简易教程"
date: 2022-07-18T17:09:28+08:00
draft: true
typora-root-url: ../../static/
---

[TOC]

## 大纲

1. 基础操作
   1. ：命令
   2. Enter
   3. filter
   4. Log
   5. Port Forward

2. 完成流程
   1. ctx
   2. ns
   3. deployment
   4. log
   5. filter


## 简介

K9s是一个基于终端的K8s UI管理工具。只需要一个二进制文件，就可以在任意的终端上对K8s进行管理。基础的操作逻辑是基于Vim的，熟悉Vim的同学几分钟就能上手。

## 安装

K9s支持Linux，macOS和Windows平台。推荐到官方[release](https://github.com/derailed/k9s/releases)界面直接下载二进制文件。

K9s与kubectl一致，默认使用环境变量KUBECONFIG指定的K8s配置。当然也可以指定kubeconfig
`k9s --kubeconfig=xx`

## 基础操作

下面使用官方提供的deployment作为演示

```bash
kubectl create -f https://k8s.io/examples/application/deployment.yaml
```

### 主界面

第一次打开会进入Context的界面。可以看到左上角的集群信息，然后主要界面是类似一个文件管理器。

![ctx](/img/19/ctx.png)

K9s默认打开上一次停留的界面，如果你看到的不是这个界面，你可以输入`:ctx`，再按下确认。这样就进入Context的浏览页面。

这个操作就是Vim的命令模式，通过输入`:`加上命令。比如`:deployment`就是查看Deployment, `:pod`就是查看pod。所有的资源都可以通过这种方式来导航到相应界面。而且命令支持缩写，例如deploy代表deployment。

另外还有自动补全，输入de会自动提示deploy, 按下`Tab`就会补全。所以命令都不用记死，知道开头的字母就行。

更多的缩写可以输入`:aliases`来查看。缩写也基本是kubectl默认支持的缩写。

![alias](/img/19/alias.png)

现在输入`:deploy` 来到Deployment浏览界面，通过方向键上下移动可以进行正常浏览，或者按照Vim的移动逻辑使用`j`和`k`来进行移动。

![deployment](/img/19/deployment.png)

接下来按下`Enter`就会默认进度Pods浏览界面。

状态栏包含了pod的基本信息，当前状态，所属ip等。

![pod](/img/19/pod.png)

上半部有提示当前可以操作的快界面。现在可以按1234来快速切换不同的namespace。

那么如果namespace太多，上面没有提示该怎么切换？

更多的快界面提示可以输入`: ?`来获取

现在选中一个pod继续按下`Enter`会进入Container浏览界面。

Container界面与Pod界面类似，再下一级就是容器对应的日志。

在Pod界面也可以按`L`来快速进度日志界面

因为没有日志，会提示`Waiting for logs...`.

这时候使用连按`Esc`退回上上一级Pod，使用到另外一个功能PortForward

在Deployment界面可以看到有PF一栏，这个就是代表PortForward，

TODO gif界面

此时按下`shift-f`，会看到以下界面

跟`kubectl port-forward`一样，选择容器的端口和本地对应的端口，然后用`Tab`切换选项，修改后确认。我这里修改本地端口为8000。

在另外一个终端访问`curl localhost:8000`

### 浏览任意资源

详情/编辑/

### 进入container

### 日志

### 编辑

## 命令

| 动作           | 命令               | 备注 |      |
| -------------- | ------------------ | ---- | ---- |
| 快捷键记录界面 | `?` |      |      |
| 显示集群所有的资源和它们的缩写 | `ctrl-a` or `:alias` | 例如service的缩写是svc |      |
| 退出 | `:q` or `ctrl-c` |      |      |
| 用资源名或者缩写来浏览某一类资源 | `:`po⏎ | 接受单数、复数、缩写或者别名。例如po,pod,pods,v1/pods |      |
| 在指定的ns里面浏览资源 | `:po namespace⏎ |  |      |
| 过滤某种资源 | `/`filter⏎ | 支持Regex2标准，例如`fred|blee`过滤名字是fred或者是blee的资源 |      |
| 逆过滤器 | `/`!filter | 去除所有匹配的资源。不支持日志过滤 | |
| 根据labels过滤资源 | `/`-l label-selector⏎ |  | |
| 模糊匹配过滤 | `/`-f filter |  | |
| 退出 浏览/命令/过滤 模式 | `<esc>` |  | |
| 常用快捷键，describe, view,edit,view logs,... | `d`,`v`,`e`,`l`,... |  | |
| 切换集群上下文 | `:`ctx⏎ |  | |
| 切换集群上下文 | `:`ctx context-name⏎ |  | |
| 切换namespace | `:`ns⏎ |  | |
| 浏览所有保存的资源 | `:`screendump or sd⏎ |  | |
| 删除资源(TAB和ENTER来确认) | `ctrl-d` |  | |
| 终止一种资源(不会有确认的对话框) | `ctrl-k` |  | |
| 扩宽显示栏 | `ctrl-w` | 等价于`kubectl ... -o wide` | |
| 浏览在错误状态的资源 | `ctrl-z` |  | |
| 增强界面 | `:`pulses or pu⏎ | 用命令行实现类似GUI的监控界面 | |
| XRay界面 | `:`xray RESOURCE [NAMESPACE]⏎ | 用目录树的结构来展示相关资源 | |
| Popeye界面 | `:`popeye or pop⏎ | Popeye是一个k8s清理工具，帮助找出有潜在问题的资源和配置，详见<https://popeyecli.io/> | |

RESOURCE                                            GENERAL                                                   NAVIGATION
│ <c>                     Cordon                      <ctrl-a>                    Aliases                       <j>                       Down
│ <ctrl-d>                Delete                      <esc>                       Back/Clear                    <shift-g>                 Goto Bottom
│ <d>                     Describe                    <ctrl-u>                    Command Clear                 <g>                       Goto Top
│ <r>                     Drain                       <:cmd>                      Command mode                  <h>                       Left
│ <e>                     Edit                        <tab>                       Field Next                    <ctrl-f>                  Page Down
│ <?>                     Help                        <backtab>                   Field Previous                <ctrl-b>                  Page Up
│ <ctrl-r>                Refresh                     </term>                     Filter mode                   <l>                       Right
│ <shift-a>               Sort Age                    <?>                         Help                          <k>                       Up
│ <shift-c>               Sort CPU                    <space>                     Mark
│ <shift-m>               Sort MEM                    <ctrl-\>                    Mark Clear
│ <shift-n>               Sort Name                   <ctrl-space>                Mark Range
│ <ctrl-z>                Toggle Faults               <:q>                        Quit
│ <ctrl-w>                Toggle Wide                 <ctrl-r>                    Reload
│ <u>                     Uncordon                    <ctrl-s>                    Save
│ <enter>                 View                        <ctrl-g>                    Toggle Crumbs
│ <y>                     YAML                        <ctrl-e>                    Toggle Header

## 有趣的功能
